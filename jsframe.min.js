/* Simple Javasctipt/JQuery MVC Framework - JSFrame 
 * Copyright (C) <2013>  Shamim Ahmed
 * CodeRangers LLC
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>
 */
//Author: Shamim Ahmed
//shamim@coderangers.com
//08/06/2013
jQuery(function(e){"use strict";var t=[],n=t={version:1,uuid:function(){var e,t,n="";for(e=0;32>e;e++)t=0|16*Math.random(),(8===e||12===e||16===e||20===e)&&(n+="-"),n+=(12===e?4:16===e?8|3&t:t).toString(16);return n},pluralize:function(e,t){return 1===e?t:t+"s"},Log:function(e){window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)},initLoader:function(e){e.parent().parent().css("position","relative"),e.before('<div class="widget-box-layer" style="width:100%"><i class="icon-spinner icon-spin icon-2x white"></i></div>')},alertMessage:function(e,t,i){e.before('<div class="alert alert-'+t+'">'+i+"</div>"),setTimeout(function(){n.destroy(".alert")},3e3)},setNewToken:function(t){e("input[name='token']").val(t)},destroy:function(t){e(t).remove()},reset:function(t){e(t)[0].reset()},hideModal:function(t,n){setTimeout(function(){e("#"+t).modal("hide")},n)},showModal:function(t){setTimeout(function(){e("#"+t).modal("show")},time)},Alert:function(e){alert(e)},Store:function(e,t){if(arguments.length>1)return localStorage.setItem(e,JSON.stringify(t));var n=localStorage.getItem(e);return n&&JSON.parse(n)||[]},animatedSkillBar:function(){e(".progress-skills").each(function(){var t=e(this),n=t.attr("data-label");percent=t.attr("data-percent")+"%",t.find(".bar").text(n+" "+"("+percent+")").animate({width:percent})})},Render:function(t,i,a){e("#"+t).html(tmpl(a,i)),n.Localize()},Ajax:function(t,a,r){n.initLoader(t);var o=e.ajax({url:i.url,type:i.type,data:a,dataType:i.dataType});o.done(function(e){n.destroy(".widget-box-layer"),i[r].apply(this,[{element:t.selector,response:e}])}),o.fail(function(e,t){n.destroy(".widget-box-layer"),n.Log("Request failed: "+t)})},responsiveVideoPlayer:function(){e(".js-video").fitVids()},scrollEffect:function(){scrollPos=e(this).scrollTop(),e("#landingSlide").css({"background-position":"center "+(200+scrollPos/4)+"px"})},scrollEffectInit:function(){e(window).scroll(function(){this.scrollEffect})},getPageName:function(){return window.location.pathname.split("/")[1]},getPageAnchor:function(){return window.location.hash},setGoToTop:function(){e("#totop").click(function(){return e("html, body").animate({scrollTop:0},300),!1})},addValidation:function(t,n){e('form[name="'+t+'"]').find("input, textarea").not("[type=submit]").jqBootstrapValidation({submitSuccess:function(e,t){t.preventDefault(),i.Controllers[n].apply(this)},filter:function(){return e(this).is(":visible")}})},getLocale:function(t){var n="";if(e.isNumeric(t)){for(var i=0;i<t.length;i++){var a=e.i18n._(t.charAt(i));n+=a}return n}return e.i18n._(t)},Localize:function(){e.each(e(".i18n"),function(){e(this)._t(e(this).html())}),e.each(e(".i18n-date"),function(){var t=e(this).html().split(" "),i=t[0],a=t[1];a=a.replace(/,+$/,"");var r=t[2];console.log(i),t=n.getLocale(i)+" "+n.getLocale(a)+", "+n.getLocale(r),e(this).html(t)}),e.each(e(".i18n-n"),function(){e(this).html(n.getLocale(e(this).html()))})},Confirm:function(t,n,i,a,r){var o=e('<div class="modal hide fade"><div class="modal-header"><a class="close" data-dismiss="modal" >&times;</a><h3>'+t+"</h3>"+"</div>"+'<div class="modal-body">'+"<p>"+n+"</p>"+"</div>"+'<div class="modal-footer">'+'<a href="#" class="btn" data-dismiss="modal">'+i+"</a>"+'<a href="#" id="okButton" class="btn btn-primary">'+a+"</a>"+"</div>"+"</div>");o.find("#okButton").click(function(){r(),o.modal("hide")}),o.modal("show")},LiveEdit:function(t){console.log(t);var n=t.data("type"),a='<span class="editable-container editable-inline" style=""><div><div class="editableform-loading" style="display: none;"></div><form id="'+t.attr("rel")+'" class="form-inline editableform" style=""><div class="control-group"><div>',r='<span class="editable-clear-x"></span></div><div class="editable-buttons"><button class="btn btn-primary editable-submit" type="submit"><i class="icon-ok icon-white"></i></button><button class="btn editable-cancel" type="button"><i class="icon-remove"></i></button></div></div><div class="editable-error-block help-block" style="display: none;"></div></div></form></div></span>';if("text"==n){var o='<div class="editable-input" style="position: relative;"><input type="text" style="padding-right: 24px;" value="'+t.html()+'" class="input-mini">';t.hide().before(a+o+r)}if("textarea"==n){var o='<div class="editable-input" style="position: relative;"><textarea class="input-large" placeholder="'+t.html()+'" rows="4">'+t.html()+"</textarea>";t.hide().before(a+o+r)}if("tags"==n){var o='<div class="editable-input" style="position: relative;width:165px;"><select data-placeholder="Select Tags" user-input="true" multiple class="chzn-select-width input-medium live-select" tabindex="16"> ',s="";e.each(t.attr("data-source").split(","),function(e,t){s+='<option selected="selected" value="'+t+'">'+t+"</option>"}),o+=s+"</select>",t.hide().before(a+o+r),i.Library.Chosen()}if("select"==n){var o='<div class="editable-input" style="position: relative;"><select class="input-medium live-select"> ',s='<option value="">Select</option>';e.getJSON("/util/"+t.data("source"),function(n){e.each(n,function(e,n){s+=t.html()==n.name?'<option value="'+n.name+'" selected>'+n.name+"</option>":'<option value="'+n.name+'">'+n.name+"</option>"}),o+=s+"</select>",t.hide().before(a+o+r)})}}},i={url:"error",type:"GET",data:"init=1",dataType:"JSON",VideoDataTable:null,init:function(){this.ENTER_KEY=13,this.cacheElements(),this.bindEvents(),n.animatedSkillBar(),n.responsiveVideoPlayer(),n.scrollEffectInit(),n.Localize()},cacheElements:function(){this.$register=e("#register")},bindEvents:function(){n.addValidation("register","CreateNewUser")},completeRegistration:function(t){n.Log(JSON.stringify(t)),n.Log(t.response.message),n.alertMessage(e(t.element),"success",t.response.message),n.reset("#register")}};i.Controllers={CreateNewUser:function(){i.url="/register/create",i.type="POST",n.Ajax(i.$register,i.$register.serialize(),"completeRegistration")}},i.Library={CreateFileUploader:function(e,t,n,a){var r=new qq.FineUploader({element:document.getElementById(e),request:{endpoint:n},text:{uploadButton:'<div><i class="icon-upload icon-white"></i><span class="i18n">Upload a file</div></div>'},template:'<div class="qq-uploader"><pre class="qq-upload-drop-area"><span>{dragZoneText}</span></pre><div class="qq-upload-button btn btn-success" style="width: auto;">{uploadButtonText}</div><span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span><ul class="qq-upload-list" style="margin-top: 10px; text-align: center;"></ul></div>',classes:{success:"alert alert-success",fail:"alert alert-error"},callbacks:{onSubmit:function(){},onComplete:function(e,t,n){n.success&&i[a].apply(this,[{response:n}])}}});return r},Chosen:function(){var t={".chzn-select":{},".chzn-select-deselect":{allow_single_deselect:!0},".chzn-select-no-single":{disable_search_threshold:10},".chzn-select-no-results":{no_results_text:"Oops, nothing found!"},".chzn-select-width":{width:"95%"}};for(var n in t)e(n).chosen(t[n])}},i.init()});